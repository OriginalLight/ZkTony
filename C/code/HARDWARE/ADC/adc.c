#include "adc.h"
#include "delay.h"	
#include "moto.h"
#include "math.h"
#include <stdio.h> 


//HT--01
//u16 TableDac[8][79]={
//{3553,3511,3469,3432,3396,3357,3318,3285,3253,3218,3183,3149,3115,3083,3052,3020,2988,2956,2925,2896,2868,2840,2813,2786,2760,2735,2711,2686,2662,2640,2618,2597,2576,2554,2533,2514,2496,2478,2461,2444,2427,2411,2396,2382,2368,2352,2337,2324,2312,2299,2286,2274,2262,2250,2238,2228,2218,2208,2198,2188,2178,2169,2161,2153,2145,2137,2129,2121,2114,2107,2101,2095,2089,2083,2077,2071,2066,2060,2055},
//{3542,3502,3462,3423,3385,3346,3307,3273,3239,3204,3169,3132,3095,3063,3032,2998,2965,2932,2900,2872,2844,2815,2787,2761,2735,2708,2682,2658,2634,2612,2590,2568,2546,2524,2503,2486,2469,2450,2431,2414,2398,2382,2367,2353,2339,2324,2310,2297,2285,2272,2259,2247,2236,2224,2212,2202,2192,2182,2172,2163,2155,2146,2138,2130,2122,2114,2107,2100,2093,2086,2080,2074,2069,2063,2057,2052,2047,2042,2037},
//{3550,3508,3466,3429,3393,3356,3319,3286,3254,3220,3187,3151,3116,3084,3053,3021,2990,2960,2931,2901,2872,2843,2815,2790,2765,2739,2714,2690,2667,2645,2623,2602,2581,2559,2538,2520,2502,2484,2467,2449,2432,2417,2403,2389,2375,2359,2344,2330,2316,2303,2291,2279,2268,2256,2244,2233,2223,2212,2202,2192,2183,2174,2165,2157,2149,2141,2133,2125,2118,2111,2104,2097,2091,2085,2080,2074,2068,2062,2057},
//{3547,3507,3467,3428,3390,3353,3316,3282,3248,3213,3178,3142,3107,3075,3044,3012,2980,2950,2920,2890,2861,2832,2804,2778,2752,2726,2701,2676,2652,2630,2608,2587,2566,2544,2523,2506,2489,2470,2452,2435,2418,2402,2386,2372,2358,2342,2327,2313,2300,2288,2277,2264,2252,2240,2228,2217,2207,2197,2187,2177,2168,2159,2151,2143,2135,2127,2119,2112,2105,2098,2092,2085,2079,2073,2068,2062,2057,2051,2046},
//{3455,3407,3359,3312,3265,3221,3178,3134,3090,3044,2998,2957,2917,2877,2838,2803,2768,2735,2702,2670,2639,2609,2579,2553,2528,2501,2475,2451,2428,2406,2385,2364,2344,2326,2308,2291,2274,2258,2242,2226,2211,2198,2186,2173,2160,2149,2138,2127,2116,2106,2097,2087,2078,2070,2062,2054,2047,2040,2033,2026,2020,2014,2009,2004,1999,1993,1987,1983,1979,1974,1969,1965,1962,1958,1955,1951,1948,1945,1942},
//{3541,3501,3461,3422,3384,3345,3306,3268,3230,3196,3163,3127,3092,3059,3026,2994,2962,2931,2900,2870,2841,2812,2784,2759,2734,2707,2681,2657,2633,2610,2587,2565,2543,2522,2502,2482,2463,2444,2426,2409,2392,2375,2358,2344,2330,2316,2302,2288,2275,2262,2249,2237,2225,2214,2203,2191,2180,2170,2161,2152,2143,2134,2125,2116,2108,2101,2094,2086,2079,2072,2066,2059,2053,2047,2042,2036,2030,2025,2021},
//{3553,3515,3478,3439,3400,3360,3321,3285,3249,3215,3182,3146,3111,3079,3048,3017,2986,2954,2923,2894,2866,2838,2810,2786,2762,2735,2709,2685,2662,2640,2618,2596,2574,2553,2533,2514,2495,2477,2459,2442,2425,2408,2391,2377,2363,2349,2335,2321,2308,2295,2282,2270,2258,2246,2235,2224,2213,2203,2193,2184,2175,2166,2157,2148,2140,2132,2125,2118,2111,2104,2098,2091,2085,2078,2072,2066,2061,2055,2050},
//{3532,3494,3457,3416,3375,3336,3297,3259,3222,3187,3152,3115,3078,3046,3015,2981,2948,2917,2886,2856,2827,2798,2770,2745,2720,2693,2667,2644,2621,2597,2573,2552,2531,2511,2491,2472,2454,2436,2419,2401,2383,2368,2353,2339,2325,2311,2297,2284,2271,2258,2245,2234,2223,2211,2199,2189,2179,2169,2160,2151,2143,2134,2125,2117,2109,2102,2095,2088,2081,2074,2068,2062,2056,2051,2046,2041,2036,2031,2026}
//};
//u16 TableAdc[8][79]={
//{2804,2734,2665,2603,2542,2476,2411,2357,2303,2244,2186,2129,2072,2018,1965,1912,1859,1806,1754,1706,1658,1612,1566,1522,1478,1437,1397,1356,1315,1279,1243,1208,1174,1138,1103,1072,1042,1013,984,955,927,901,876,853,831,806,781,760,740,718,696,677,658,638,619,603,587,570,554,537,521,507,493,480,467,454,441,429,418,407,397,387,377,367,358,349,341,332,323},
//{2799,2732,2666,2601,2536,2469,2403,2346,2290,2231,2172,2110,2048,1994,1940,1884,1829,1774,1720,1673,1626,1578,1530,1487,1444,1400,1356,1315,1275,1238,1202,1166,1130,1094,1059,1031,1003,972,941,913,885,859,834,811,788,764,741,720,699,678,657,638,620,600,581,565,549,532,516,501,487,473,460,447,434,422,410,399,388,377,367,357,348,339,330,322,314,305,297},
//{2821,2751,2681,2620,2559,2496,2434,2379,2325,2269,2214,2155,2096,2043,1991,1938,1886,1836,1787,1737,1688,1641,1594,1552,1510,1468,1426,1386,1346,1309,1272,1237,1203,1167,1131,1101,1071,1042,1013,983,954,930,906,883,861,835,809,786,764,742,721,702,683,663,644,627,610,593,577,561,545,530,515,502,489,476,463,451,439,428,418,407,396,387,378,369,360,350,341},
//{2803,2736,2669,2604,2539,2477,2415,2359,2303,2244,2185,2125,2066,2012,1959,1905,1852,1801,1750,1701,1652,1604,1557,1513,1470,1428,1387,1345,1304,1267,1231,1196,1162,1126,1090,1062,1034,1003,972,943,915,889,863,840,818,792,767,745,723,704,685,664,644,624,605,588,572,556,540,524,508,494,481,468,455,442,429,418,407,396,386,375,365,356,348,339,331,322,313},
//{2668,2587,2507,2429,2351,2277,2204,2131,2058,1980,1902,1833,1765,1699,1634,1575,1517,1462,1407,1355,1303,1253,1204,1161,1118,1074,1030,990,951,915,879,845,812,782,753,725,697,670,644,618,593,572,552,531,510,492,474,455,437,422,407,392,377,364,352,340,328,316,305,294,284,275,267,259,251,241,232,226,220,212,204,199,194,188,183,178,173,169,165},
//{2817,2750,2684,2620,2556,2491,2426,2363,2300,2245,2190,2131,2072,2016,1960,1907,1855,1803,1752,1703,1654,1607,1560,1518,1477,1433,1390,1351,1312,1274,1236,1200,1164,1130,1097,1065,1033,1002,972,944,916,888,861,838,816,792,769,747,726,704,683,663,644,626,608,589,571,555,540,525,511,496,482,468,454,443,432,420,408,397,387,376,366,357,348,338,329,322,315},
//{2822,2759,2697,2632,2567,2500,2433,2373,2314,2258,2202,2142,2083,2029,1976,1925,1874,1820,1767,1720,1673,1626,1579,1539,1499,1455,1411,1372,1333,1295,1258,1222,1186,1151,1117,1086,1055,1025,996,967,938,909,881,858,836,812,789,767,745,723,702,682,662,643,625,607,589,573,557,542,528,513,498,484,470,458,446,435,424,413,402,391,381,370,360,352,344,335,326},
//{2794,2731,2669,2600,2531,2464,2398,2335,2273,2214,2156,2094,2033,1980,1927,1871,1816,1764,1712,1663,1614,1566,1519,1477,1435,1391,1347,1309,1271,1231,1192,1157,1122,1088,1054,1023,993,964,935,905,875,850,825,802,780,756,732,711,690,668,647,629,611,592,573,556,540,524,509,495,481,466,452,439,427,415,404,393,382,371,361,351,342,334,326,318,310,302,294}
//};


//HT--09
//u16 TableDac[8][79]={

//{3544,3506,3468,3423,3378,3343,3308,3270,3232,3198,3165,3126,3087,3054,3021,2987,2954,2923,2892,2863,2834,2806,2779,2751,2723,2697,2672,2648,2624,2601,2578,2556,2535,2514,2494,2475,2457,2438,2419,2401,2384,2369,2354,2340,2326,2311,2296,2283,2271,2259,2247,2234,2222,2211,2200,2189,2178,2169,2161,2151,2142,2133,2125,2117,2109,2101,2094,2087,2080,2073,2067,2061,2055,2049,2044,2038,2033,2027,2022},
//{3554,3516,3479,3434,3389,3356,3323,3285,3247,3213,3180,3142,3105,3072,3039,3005,2972,2940,2909,2879,2850,2822,2795,2767,2740,2714,2689,2665,2641,2618,2595,2573,2551,2530,2510,2491,2472,2454,2436,2418,2400,2384,2369,2355,2342,2327,2313,2300,2287,2274,2261,2249,2237,2225,2214,2203,2193,2183,2174,2165,2157,2148,2139,2131,2123,2115,2108,2101,2094,2087,2081,2075,2070,2064,2058,2052,2046,2041,2036},
//{3566,3533,3500,3455,3410,3376,3343,3304,3266,3232,3198,3162,3126,3091,3057,3024,2992,2961,2931,2901,2872,2843,2815,2788,2762,2737,2713,2688,2664,2641,2618,2597,2576,2556,2536,2517,2498,2480,2462,2444,2427,2411,2396,2382,2369,2354,2340,2327,2314,2301,2289,2277,2265,2254,2244,2233,2222,2212,2202,2194,2186,2176,2167,2160,2153,2144,2136,2130,2124,2116,2109,2104,2099,2093,2087,2081,2075,2070,2065},
//{3546,3506,3466,3423,3381,3346,3311,3273,3235,3201,3168,3129,3090,3057,3024,2990,2957,2927,2897,2867,2838,2810,2783,2756,2729,2704,2680,2655,2630,2607,2584,2562,2540,2521,2502,2483,2464,2446,2428,2411,2394,2377,2361,2347,2334,2319,2305,2292,2280,2268,2256,2243,2231,2220,2210,2198,2187,2177,2168,2160,2152,2143,2134,2126,2118,2110,2103,2096,2090,2083,2076,2070,2064,2058,2052,2046,2041,2036,2032},
//{3537,3499,3462,3419,3377,3342,3307,3275,3243,3209,3176,3140,3105,3072,3039,3007,2975,2944,2913,2884,2856,2828,2801,2775,2749,2723,2698,2674,2651,2629,2607,2586,2565,2543,2522,2503,2485,2467,2449,2431,2414,2398,2383,2368,2353,2338,2324,2310,2297,2284,2271,2259,2247,2235,2223,2213,2203,2193,2183,2174,2165,2155,2146,2137,2128,2121,2114,2106,2099,2092,2085,2078,2072,2066,2060,2054,2049,2044,2039},
//{3548,3508,3468,3425,3383,3346,3309,3275,3241,3205,3170,3129,3089,3054,3020,2985,2951,2920,2889,2858,2828,2798,2769,2742,2715,2688,2662,2638,2614,2591,2568,2547,2526,2504,2482,2462,2443,2426,2409,2391,2374,2357,2341,2327,2313,2298,2283,2269,2256,2244,2232,2220,2208,2196,2185,2174,2164,2154,2145,2136,2128,2118,2109,2101,2093,2086,2080,2073,2066,2059,2052,2046,2040,2034,2029,2024,2019,2013,2008},
//{3569,3531,3493,3450,3407,3371,3336,3301,3267,3233,3199,3161,3124,3091,3058,3024,2990,2958,2926,2897,2869,2840,2812,2785,2759,2732,2706,2681,2657,2634,2611,2590,2569,2548,2528,2509,2490,2472,2455,2437,2420,2403,2386,2372,2358,2344,2330,2315,2301,2288,2276,2264,2252,2241,2230,2219,2208,2198,2188,2178,2169,2160,2151,2143,2135,2127,2120,2113,2106,2099,2093,2086,2080,2074,2068,2063,2058,2053,2048},
//{3544,3506,3468,3425,3383,3346,3309,3275,3241,3205,3170,3129,3089,3054,3020,2985,2951,2920,2889,2857,2826,2798,2771,2743,2715,2689,2664,2639,2614,2591,2568,2547,2526,2504,2483,2464,2445,2427,2410,2392,2374,2358,2343,2328,2314,2299,2284,2271,2258,2245,2232,2220,2208,2197,2186,2175,2165,2155,2146,2137,2129,2119,2110,2102,2094,2087,2080,2073,2066,2059,2052,2046,2041,2035,2029,2023,2018,2013,2008}
//			
//};



//u16 TableAdc[8][79]={

//{2802,2738,2675,2601,2527,2468,2410,2347,2285,2229,2173,2108,2043,1988,1934,1878,1823,1771,1719,1671,1623,1577,1531,1485,1440,1398,1356,1316,1277,1239,1202,1166,1130,1096,1062,1031,1000,969,938,909,881,857,834,810,787,762,738,717,697,677,658,637,616,598,581,563,546,531,517,502,487,474,461,447,434,422,411,400,389,378,368,359,350,340,331,323,315,306,298},
//{2780,2718,2657,2582,2508,2453,2399,2336,2274,2218,2162,2099,2037,1982,1928,1872,1817,1764,1712,1664,1617,1571,1525,1480,1436,1394,1353,1313,1274,1236,1198,1161,1125,1092,1059,1027,996,967,939,909,879,854,830,807,785,762,739,718,697,675,654,635,616,597,579,562,546,530,515,501,488,474,461,447,434,422,411,400,389,379,369,360,352,342,333,324,315,307,300},
//{2777,2722,2667,2592,2518,2462,2407,2343,2280,2224,2168,2108,2049,1991,1934,1880,1827,1776,1725,1677,1629,1582,1535,1491,1447,1407,1367,1326,1285,1247,1209,1174,1140,1106,1073,1041,1010,981,952,923,895,869,844,821,799,776,753,732,711,689,668,649,630,613,596,578,561,544,528,515,502,487,473,461,449,435,421,411,401,389,378,370,362,352,343,334,325,317,309},
//{2772,2706,2640,2570,2500,2442,2384,2321,2258,2203,2149,2084,2019,1964,1910,1855,1800,1750,1700,1651,1603,1557,1511,1467,1423,1383,1343,1302,1261,1223,1185,1148,1112,1081,1050,1018,987,958,929,901,874,847,821,799,777,754,731,710,690,670,651,631,611,594,577,559,541,525,509,496,484,470,457,444,431,419,407,396,385,374,364,355,346,336,327,318,310,303,296},
//{2809,2746,2684,2612,2541,2482,2424,2370,2317,2261,2206,2147,2088,2031,1975,1921,1868,1816,1765,1717,1670,1624,1579,1535,1492,1450,1408,1368,1329,1292,1256,1221,1186,1150,1115,1084,1054,1024,995,966,937,911,886,861,837,813,789,767,746,724,702,683,664,644,624,608,592,575,559,544,530,515,500,486,472,460,449,436,424,413,403,392,382,372,363,354,346,338,330},
//{2804,2738,2672,2601,2531,2469,2408,2352,2296,2238,2181,2114,2047,1990,1933,1876,1820,1769,1718,1668,1618,1569,1520,1476,1433,1389,1346,1307,1268,1230,1193,1158,1124,1088,1052,1020,988,960,933,905,878,851,825,802,780,755,730,709,688,668,648,629,610,591,573,556,539,523,508,494,481,466,452,439,426,415,405,393,382,371,361,351,341,333,325,317,309,301,293},
//{2802,2739,2677,2605,2534,2476,2419,2361,2304,2248,2193,2130,2067,2012,1957,1901,1845,1792,1739,1692,1645,1598,1551,1507,1464,1421,1379,1338,1298,1260,1222,1188,1154,1120,1086,1054,1022,994,966,937,908,880,853,830,808,785,762,739,716,695,675,656,637,619,601,583,566,550,534,518,502,488,474,461,449,436,424,412,401,391,382,370,359,350,341,333,326,318,311},
//{2790,2727,2665,2594,2524,2463,2402,2345,2289,2232,2175,2108,2042,1985,1928,1871,1815,1764,1713,1661,1610,1564,1519,1474,1429,1387,1346,1305,1265,1227,1190,1155,1121,1086,1051,1019,988,960,932,903,875,850,826,802,778,753,729,708,688,666,645,626,608,590,572,555,538,522,507,493,480,465,451,438,426,414,403,391,380,369,359,350,341,331,322,314,306,299,292}
//	

//};


//////////////////////////////////////////////////////////////////////////////////	 HT10;
//u16 TableDac[8][79]={

//{3534,3492,3451,3410,3370,3335,3300,3262,3224,3191,3158,3119,3081,3046,3012,2978,2945,2915,2886,2855,2825,2796,2768,2740,2712,2687,2663,2640,2617,2593,2569,2547,2526,2505,2485,2466,2447,2430,2414,2396,2378,2361,2345,2331,2318,2303,2289,2275,2262,2250,2239,2227,2215,2203,2192,2183,2174,2163,2153,2144,2136,2127,2119,2110,2102,2094,2087,2081,2075,2068,2061,2054,2048,2042,2037,2032,2027,2022,2018},
//{3513,3469,3426,3388,3351,3318,3285,3247,3210,3175,3141,3104,3067,3036,3005,2971,2938,2907,2876,2848,2820,2790,2761,2733,2705,2682,2659,2635,2612,2589,2566,2545,2524,2504,2485,2465,2446,2429,2413,2395,2378,2361,2345,2331,2317,2302,2287,2274,2261,2249,2237,2226,2215,2203,2191,2181,2172,2162,2152,2143,2134,2126,2118,2109,2101,2094,2087,2081,2075,2068,2061,2054,2048,2042,2037,2031,2026,2021,2016},
//{3524,3480,3437,3399,3362,3329,3296,3262,3228,3193,3158,3121,3084,3054,3024,2990,2957,2926,2895,2867,2839,2809,2779,2752,2725,2702,2680,2656,2632,2609,2586,2566,2546,2524,2503,2484,2465,2448,2431,2413,2395,2378,2362,2347,2332,2317,2302,2289,2276,2263,2250,2239,2228,2216,2204,2194,2184,2173,2163,2154,2146,2137,2129,2119,2110,2103,2097,2090,2084,2076,2069,2062,2055,2049,2044,2038,2033,2028,2023},
//{3562,3525,3488,3449,3411,3377,3344,3305,3267,3233,3199,3161,3124,3092,3061,3026,2991,2960,2929,2900,2872,2841,2810,2781,2753,2729,2706,2682,2659,2636,2613,2592,2571,2549,2528,2509,2490,2473,2456,2438,2421,2404,2387,2373,2359,2343,2328,2315,2302,2289,2277,2266,2255,2243,2231,2221,2211,2200,2190,2181,2172,2164,2156,2146,2137,2130,2124,2118,2112,2104,2096,2089,2083,2077,2072,2067,2062,2056,2051},
//{3537,3493,3449,3413,3377,3340,3303,3267,3231,3197,3164,3130,3096,3061,3027,2994,2961,2932,2904,2874,2845,2816,2788,2763,2738,2711,2685,2662,2639,2616,2593,2570,2548,2527,2507,2489,2471,2453,2435,2417,2399,2383,2367,2353,2340,2325,2311,2297,2283,2270,2258,2246,2235,2223,2212,2202,2192,2182,2172,2163,2154,2145,2137,2128,2120,2113,2106,2098,2091,2084,2078,2071,2065,2059,2054,2048,2043,2038,2033},
//{3541,3494,3448,3407,3367,3328,3289,3249,3210,3172,3134,3092,3051,3014,2977,2942,2908,2876,2844,2811,2779,2748,2718,2694,2671,2642,2614,2589,2565,2541,2518,2495,2473,2452,2432,2415,2398,2380,2363,2343,2323,2308,2293,2279,2266,2253,2240,2226,2212,2200,2189,2177,2166,2158,2151,2140,2130,2121,2113,2105,2097,2090,2083,2076,2070,2064,2058,2051,2044,2039,2034,2028,2022,2017,2013,2008,2003,1999,1996},
//{3569,3529,3490,3454,3418,3382,3347,3310,3274,3240,3206,3171,3136,3104,3072,3039,3007,2976,2946,2916,2886,2859,2832,2806,2781,2755,2730,2705,2681,2659,2637,2615,2593,2572,2552,2533,2514,2497,2481,2462,2443,2428,2413,2398,2384,2370,2356,2342,2329,2316,2303,2292,2281,2269,2257,2247,2237,2227,2217,2208,2200,2191,2183,2174,2166,2159,2153,2146,2139,2132,2126,2119,2113,2107,2102,2096,2091,2086,2081},
//{3529,3485,3441,3403,3365,3328,3291,3255,3219,3182,3146,3110,3075,3038,3001,2968,2935,2905,2876,2846,2816,2787,2758,2733,2708,2681,2655,2631,2608,2584,2561,2539,2518,2497,2476,2457,2438,2421,2404,2385,2367,2350,2334,2320,2307,2293,2279,2266,2253,2240,2227,2215,2204,2193,2183,2172,2162,2153,2144,2135,2126,2118,2110,2102,2094,2087,2081,2074,2068,2061,2055,2048,2042,2037,2032,2026,2021,2017,2013}

//	
//};

//u16 TableAdc[8][79]={
//	
//{2800,2730,2660,2592,2524,2464,2405,2342,2279,2224,2170,2105,2041,1983,1926,1870,1814,1764,1715,1664,1614,1566,1518,1471,1425,1383,1342,1304,1266,1226,1186,1150,1115,1081,1048,1017,986,958,930,900,870,843,817,794,772,748,724,702,680,661,643,623,603,584,566,551,537,519,502,488,474,461,448,434,421,409,397,388,379,367,356,347,339,329,319,311,303,296,290},
//{2773,2700,2627,2564,2502,2446,2391,2329,2267,2209,2151,2088,2026,1974,1923,1866,1810,1758,1707,1660,1613,1564,1515,1469,1423,1384,1346,1306,1267,1229,1191,1156,1121,1089,1058,1025,993,965,938,909,880,853,827,804,781,757,733,712,691,671,652,634,617,597,578,562,547,530,514,499,484,471,459,445,432,420,409,399,390,378,367,358,350,340,330,321,313,305,298},
//{2801,2728,2656,2594,2532,2477,2422,2366,2311,2253,2195,2133,2072,2021,1971,1915,1860,1808,1756,1709,1663,1613,1564,1519,1474,1436,1398,1358,1319,1281,1243,1210,1177,1142,1108,1077,1046,1017,989,959,929,902,875,850,826,801,777,755,734,712,691,673,656,636,617,601,585,567,550,535,521,507,494,478,463,453,443,432,422,409,397,387,377,367,358,349,341,333,326},
//{2770,2709,2648,2583,2518,2462,2407,2343,2280,2224,2169,2106,2044,1991,1939,1881,1823,1771,1720,1673,1626,1576,1526,1479,1433,1394,1356,1317,1278,1240,1203,1169,1135,1100,1065,1034,1003,975,948,918,889,861,834,811,789,764,739,718,698,677,657,639,622,603,584,568,553,536,519,504,490,477,464,449,434,424,414,404,395,382,369,360,352,342,333,325,318,309,301},
//{2799,2725,2652,2592,2532,2470,2408,2348,2289,2232,2176,2119,2063,2004,1946,1891,1836,1788,1740,1691,1643,1596,1549,1507,1466,1422,1378,1339,1301,1263,1226,1188,1150,1116,1083,1053,1024,994,965,935,905,878,852,830,808,784,761,738,716,694,673,655,637,618,599,583,568,551,535,519,504,491,478,464,450,439,428,416,404,393,383,374,365,355,345,336,328,320,313},
//{2761,2683,2605,2538,2472,2407,2343,2278,2213,2150,2087,2018,1950,1889,1829,1771,1714,1661,1609,1555,1501,1451,1401,1362,1323,1276,1229,1189,1150,1111,1073,1036,999,966,933,904,876,848,820,788,756,731,707,685,663,642,622,600,578,559,541,522,503,491,479,462,446,432,419,406,394,382,371,360,350,341,333,321,309,301,293,285,278,270,262,255,248,243,238},
//{2791,2724,2658,2597,2537,2477,2417,2355,2294,2237,2180,2121,2062,2008,1955,1900,1845,1793,1742,1691,1641,1596,1552,1508,1465,1423,1381,1340,1299,1262,1225,1188,1151,1117,1083,1051,1020,992,965,934,903,877,851,827,804,781,759,737,716,694,672,653,635,616,597,581,565,548,532,518,504,490,477,463,449,438,428,417,406,395,385,375,365,356,347,338,330,322,315},
//{2774,2700,2627,2564,2501,2439,2377,2317,2258,2198,2138,2079,2020,1959,1898,1843,1789,1739,1690,1640,1590,1542,1495,1453,1411,1367,1324,1286,1248,1209,1171,1135,1100,1066,1033,1001,970,942,915,885,855,828,801,779,758,735,712,691,671,649,628,610,592,575,558,541,525,510,495,480,466,453,441,428,416,406,396,385,375,364,354,344,335,326,318,310,302,296,291}


//};


//////////////////////////////////////////////////////////////////////////////////	 9;




//HT//003
//u16 TableDac[8][79]={

//{3540,3502,3464,3423,3383,3348,3313,3277,3241,3205,3170,3137,3105,3070,3036,3006,2977,2944,2912,2883,2855,2826,2798,2774,2750,2721,2693,2669,2646,2624,2602,2582,2563,2540,2518,2500,2482,2464,2446,2429,2413,2397,2382,2366,2351,2335,2319,2308,2297,2282,2268,2257,2246,2235,2224,2213,2202,2192,2182,2173,2165,2156,2148,2139,2131,2123,2116,2109,2103,2096,2089,2083,2077,2070,2064,2059,2054,2048,2043},
//{3512,3479,3447,3404,3362,3329,3296,3258,3221,3186,3151,3118,3086,3050,3014,2984,2955,2923,2891,2862,2833,2804,2776,2752,2728,2699,2671,2647,2623,2601,2579,2559,2540,2518,2496,2477,2459,2441,2424,2407,2390,2374,2358,2343,2328,2313,2298,2285,2273,2259,2246,2234,2223,2212,2201,2189,2178,2168,2158,2150,2142,2132,2123,2115,2107,2100,2093,2085,2078,2071,2065,2058,2052,2046,2041,2035,2029,2024,2019},
//{3560,3524,3489,3448,3407,3373,3340,3303,3267,3231,3196,3163,3131,3096,3062,3032,3002,2970,2938,2909,2881,2853,2825,2799,2774,2747,2721,2696,2672,2650,2629,2609,2590,2567,2545,2527,2509,2492,2475,2458,2441,2425,2409,2394,2379,2364,2350,2337,2324,2310,2297,2286,2275,2263,2251,2241,2231,2220,2210,2202,2194,2184,2174,2166,2158,2150,2143,2135,2128,2121,2114,2108,2102,2096,2091,2084,2078,2073,2068},
//{3517,3482,3447,3404,3362,3327,3292,3254,3217,3180,3144,3110,3076,3040,3005,2975,2946,2912,2879,2850,2821,2792,2764,2739,2714,2686,2659,2634,2610,2587,2564,2544,2525,2503,2481,2462,2444,2428,2412,2394,2377,2361,2346,2330,2315,2300,2286,2275,2264,2250,2236,2225,2214,2201,2189,2179,2169,2159,2149,2142,2135,2125,2116,2108,2101,2094,2088,2080,2073,2066,2059,2053,2048,2042,2037,2031,2026,2021,2017},
//{3540,3502,3465,3426,3388,3349,3310,3276,3242,3210,3178,3140,3103,3070,3037,3007,2978,2943,2908,2881,2854,2826,2799,2773,2748,2719,2691,2669,2648,2625,2602,2581,2561,2539,2518,2498,2479,2462,2446,2428,2410,2394,2378,2362,2347,2333,2319,2306,2294,2279,2265,2254,2243,2231,2219,2208,2198,2187,2177,2169,2161,2152,2143,2134,2125,2118,2111,2103,2096,2089,2083,2076,2070,2064,2058,2053,2048,2043,2038},
//{3539,3501,3464,3425,3387,3348,3309,3275,3241,3207,3174,3136,3099,3064,3030,3000,2971,2936,2901,2872,2844,2816,2789,2762,2736,2709,2683,2661,2639,2615,2591,2571,2552,2530,2508,2488,2469,2452,2435,2418,2401,2384,2368,2353,2339,2324,2310,2297,2285,2271,2258,2247,2236,2224,2212,2202,2192,2182,2172,2163,2154,2145,2137,2128,2119,2112,2106,2098,2091,2084,2078,2071,2065,2059,2053,2048,2044,2039,2034},
//{3570,3532,3495,3458,3421,3379,3338,3305,3272,3238,3204,3169,3134,3098,3062,3032,3002,2967,2933,2903,2873,2844,2816,2790,2765,2738,2712,2690,2669,2645,2621,2601,2582,2559,2536,2517,2499,2480,2462,2445,2428,2411,2395,2381,2367,2353,2339,2326,2313,2299,2286,2274,2263,2251,2240,2229,2219,2208,2198,2188,2179,2170,2162,2153,2144,2137,2131,2123,2116,2109,2102,2095,2089,2083,2078,2072,2067,2062,2058},
//{3537,3495,3454,3413,3373,3332,3291,3255,3219,3182,3146,3112,3078,3039,3000,2970,2941,2905,2869,2836,2804,2776,2748,2722,2696,2669,2643,2618,2594,2572,2551,2531,2511,2488,2465,2446,2428,2411,2395,2376,2358,2343,2328,2313,2299,2286,2273,2260,2248,2234,2220,2210,2200,2188,2177,2166,2156,2146,2137,2129,2121,2113,2105,2097,2090,2083,2076,2069,2063,2056,2050,2044,2039,2034,2029,2023,2018,2014,2010}
//	
//};



//u16 TableAdc[8][79]={

//{2789,2726,2664,2596,2529,2471,2413,2353,2293,2232,2172,2118,2064,2005,1947,1898,1849,1794,1740,1693,1646,1598,1551,1511,1472,1424,1376,1337,1299,1263,1227,1194,1161,1123,1085,1055,1026,996,966,939,913,887,862,836,811,785,760,742,724,700,676,658,641,622,603,586,569,553,538,522,507,493,480,466,453,441,429,419,409,398,387,377,368,358,348,340,333,323,314},
//{2785,2730,2676,2605,2535,2479,2424,2361,2299,2239,2180,2126,2073,2011,1950,1901,1852,1798,1745,1697,1649,1601,1554,1514,1475,1427,1379,1340,1302,1266,1230,1196,1163,1126,1090,1060,1030,1000,971,944,917,890,864,839,815,790,765,745,725,703,681,662,644,625,607,589,572,555,538,524,511,495,480,467,455,444,433,421,409,398,388,377,367,358,350,341,332,323,315},
//{2775,2716,2658,2590,2522,2466,2411,2350,2289,2230,2171,2117,2064,2006,1949,1900,1851,1797,1743,1696,1650,1604,1559,1516,1474,1430,1386,1346,1307,1272,1237,1204,1172,1134,1096,1067,1039,1010,982,954,927,901,875,850,825,802,779,758,737,714,691,673,655,636,617,601,585,568,552,538,525,509,493,479,466,455,444,432,420,409,398,388,378,369,361,351,341,332,324},
//{2769,2710,2652,2582,2512,2454,2396,2334,2272,2210,2148,2090,2033,1973,1914,1865,1816,1759,1702,1655,1608,1560,1512,1471,1430,1384,1338,1298,1258,1221,1185,1151,1118,1081,1045,1015,985,958,931,902,874,849,825,799,774,750,727,709,692,668,645,627,609,588,568,552,537,520,504,492,480,465,451,439,427,416,406,394,382,371,361,351,342,333,325,316,308,301,294},
//{2805,2742,2679,2614,2550,2485,2420,2364,2308,2255,2202,2139,2077,2021,1965,1916,1867,1807,1748,1703,1659,1613,1567,1525,1483,1435,1388,1353,1319,1281,1243,1209,1175,1138,1102,1070,1039,1011,983,953,923,898,873,848,823,800,778,756,735,711,688,670,652,633,614,597,580,563,547,533,519,504,490,475,461,450,439,427,415,405,396,384,373,364,355,347,340,331,323},
//{2787,2724,2661,2596,2532,2467,2403,2346,2290,2234,2178,2116,2054,1996,1938,1889,1841,1781,1722,1675,1629,1583,1537,1493,1450,1405,1361,1325,1290,1251,1212,1179,1146,1109,1073,1042,1011,982,954,926,898,871,845,821,798,775,752,731,710,688,666,648,630,611,593,577,561,544,528,513,498,485,472,457,443,432,422,410,398,388,378,367,357,347,338,331,324,316,308},
//{2795,2732,2669,2607,2546,2477,2409,2354,2299,2243,2188,2130,2073,2012,1952,1903,1855,1797,1740,1691,1642,1595,1549,1506,1464,1420,1376,1341,1306,1267,1228,1196,1164,1125,1087,1057,1028,997,966,937,909,883,857,834,811,789,767,745,724,701,679,660,641,623,606,589,573,556,539,523,508,494,481,466,452,441,430,418,406,396,386,375,364,355,346,338,330,322,315},
//{2794,2724,2655,2586,2517,2449,2382,2321,2261,2199,2138,2081,2024,1958,1892,1843,1795,1734,1674,1620,1567,1520,1474,1431,1388,1343,1299,1259,1220,1184,1149,1115,1082,1044,1006,976,947,919,891,860,830,807,784,759,735,715,695,674,654,631,608,591,574,555,537,520,503,487,472,459,446,434,422,410,398,386,375,364,354,344,335,326,317,309,302,293,284,278,272}

//};


/* define ---------------------------------------------------------------------*/
//#define ADC_CDR_ADDRESS          ((uint32_t)0x40012308)
#define ADC_CDR_ADDRESS          ((uint32_t)0x4001204C)

/* 变量 ----------------------------------------------------------------------*/
volatile u16 aADCDualConvertedValue[96][8];
volatile float TempNow[8];
volatile u8 TempLast[8]={0};

volatile u16 ConvertedValue[96][8];
//volatile u16 ConvertedValue[32][8];
//volatile u16 FilterValue[8];

u16 BDDac[8];
u16 BDAdc[8]; 
u8 FlagDMA=0; 
float ad[8];

// u8 JRFlag =0;
//u16 JRTime  =0;
/*
*********************************************************************************************************
*	函 数 名: bsp_InitADC
*	功能说明: ADC初始化
*	形    参: 无
*	返 回 值: 无
*********************************************************************************************************
*/
void bsp_InitADC(void)
{
	ADC_InitTypeDef       ADC_InitStructure;
	ADC_CommonInitTypeDef ADC_CommonInitStructure;
	DMA_InitTypeDef       DMA_InitStructure;
	GPIO_InitTypeDef      GPIO_InitStructure;
	NVIC_InitTypeDef NVIC_InitStructure;
	
	
	/* 使能外设时钟 */
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2 | RCC_AHB1Periph_GPIOA , ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);
    
    /* 配置引脚 */
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2|GPIO_Pin_3|GPIO_Pin_4|GPIO_Pin_5|GPIO_Pin_6|GPIO_Pin_7;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;                          //@lyt，模拟输入
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL ;
	GPIO_Init(GPIOA, &GPIO_InitStructure);
    


	/* DMA2 Stream0 channel0 配置-------------------------------------------------- */
	DMA_InitStructure.DMA_Channel = DMA_Channel_0;                            //通道0
	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)ADC_CDR_ADDRESS;
	DMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)&ConvertedValue;
	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
	DMA_InitStructure.DMA_BufferSize = 768;                            //缓存大小 每次传输数据量
	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
    
  DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;//每次DMA传输，一个数据的大小
  DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_HalfWord;
    
	DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;
	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
	DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Disable;         
	DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;
	DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;                 //一次传输，分为多少数据块
	DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
	DMA_Init(DMA2_Stream0, &DMA_InitStructure);
	
	NVIC_InitStructure.NVIC_IRQChannel = DMA2_Stream0_IRQn;//串口1中断通道
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=3;//抢占优先级3
	NVIC_InitStructure.NVIC_IRQChannelSubPriority =2;		//子优先级3
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;			//IRQ通道使能
	NVIC_Init(&NVIC_InitStructure);	//根据指定的参数初始化VIC寄存器、	
	
	
		DMA_ITConfig(DMA2_Stream0, DMA_IT_TC, ENABLE);//开启中断   

//	/* DMA2_Stream0 enable */
//	DMA_Cmd(DMA2_Stream0, ENABLE);
//    
    /****************************************************************************   
	  PCLK2 = HCLK / 2 
	  下面选择的是2分频
	  ADCCLK = PCLK2 /8 = HCLK / 8 = 168 / 8 = 21M
      ADC采样频率： Sampling Time + Conversion Time = 480 + 12 cycles = 492cyc
                    Conversion Time = 21MHz / 492cyc = 42.6ksps. 
	*****************************************************************************/
    
/* ADC Common 配置 ----------------------------------------------------------*/
	ADC_CommonInitStructure.ADC_Mode = ADC_Mode_Independent;
	ADC_CommonInitStructure.ADC_Prescaler = ADC_Prescaler_Div4;
	ADC_CommonInitStructure.ADC_DMAAccessMode = ADC_DMAAccessMode_Disabled;
	ADC_CommonInitStructure.ADC_TwoSamplingDelay = ADC_TwoSamplingDelay_10Cycles;
	ADC_CommonInit(&ADC_CommonInitStructure);

	/* ADC1 regular channel 12 configuration ************************************/
	ADC_InitStructure.ADC_Resolution = ADC_Resolution_12b;
	ADC_InitStructure.ADC_ScanConvMode = ENABLE;
	ADC_InitStructure.ADC_ContinuousConvMode = DISABLE;
	ADC_InitStructure.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConvEdge_Rising;
	ADC_InitStructure.ADC_ExternalTrigConv =ADC_ExternalTrigConv_T2_TRGO;
	ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;
	ADC_InitStructure.ADC_NbrOfConversion = 8;
	ADC_Init(ADC1, &ADC_InitStructure);

	/* Enable ADC1 DMA */
	ADC_DMACmd(ADC1, ENABLE);    //@lyt， 开启adc的dma支持，需要使用dma还需配置dma

//    /* ADC1 regular channel18 (VBAT) configuration ******************************/
//    ADC_RegularChannelConfig(ADC1, ADC_Channel_16, 1, ADC_SampleTime_480Cycles);
//    /* ADC1 regular channel18 (VBAT) configuration ******************************/
//    ADC_RegularChannelConfig(ADC1, ADC_Channel_Vbat, 2, ADC_SampleTime_144Cycles);
	
	/* ADC1 regular channels 10, 11 configuration */ 
	ADC_RegularChannelConfig(ADC1, ADC_Channel_0, 1, ADC_SampleTime_56Cycles);
	ADC_RegularChannelConfig(ADC1, ADC_Channel_1, 2, ADC_SampleTime_56Cycles);   
	
	ADC_RegularChannelConfig(ADC1, ADC_Channel_2, 3, ADC_SampleTime_56Cycles);
	ADC_RegularChannelConfig(ADC1, ADC_Channel_3, 4, ADC_SampleTime_56Cycles); 
	
	ADC_RegularChannelConfig(ADC1, ADC_Channel_4, 5, ADC_SampleTime_56Cycles);
	ADC_RegularChannelConfig(ADC1, ADC_Channel_5, 6, ADC_SampleTime_56Cycles);   
	
	ADC_RegularChannelConfig(ADC1, ADC_Channel_6, 7, ADC_SampleTime_56Cycles);
	ADC_RegularChannelConfig(ADC1, ADC_Channel_7, 8, ADC_SampleTime_56Cycles); 



	/* Enable DMA request after last transfer (Single-ADC mode) */
	ADC_DMARequestAfterLastTransferCmd(ADC1, ENABLE);            //源数据变化时，开启DMA

	DMA_Cmd(DMA2_Stream0, ENABLE);
	/* Enable ADC1 **************************************************************/
	ADC_Cmd(ADC1, ENABLE);
	
	 /* Start ADC1 Software Conversion */
	ADC_SoftwareStartConv(ADC1);
}



void DMA2_Stream0_IRQHandler(void)
{
	
	if(DMA_GetITStatus(DMA2_Stream0,DMA_IT_TCIF0)!=RESET)
	{
		 TIM_Cmd(TIM2, DISABLE);		
		// filter();		
		 FlagDMA =1;
	}	
	DMA_ClearITPendingBit(DMA2_Stream0,DMA_IT_TCIF0);
	//TIM_Cmd(TIM2, ENABLE);
}


//初始化ADC															   
void  Adc_Init(void)
{    
  GPIO_InitTypeDef  GPIO_InitStructure;
	ADC_CommonInitTypeDef ADC_CommonInitStructure;
	ADC_InitTypeDef       ADC_InitStructure;
	
  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);//使能GPIOA时钟
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE); //使能ADC1时钟

  //先初始化ADC1通道5 IO口
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2|GPIO_Pin_3;//PA5 通道5
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;//模拟输入
  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL ;//不带上下拉
  GPIO_Init(GPIOA, &GPIO_InitStructure);//初始化  
 
	RCC_APB2PeriphResetCmd(RCC_APB2Periph_ADC1,ENABLE);	  //ADC1复位
	RCC_APB2PeriphResetCmd(RCC_APB2Periph_ADC1,DISABLE);	//复位结束	 
 
	
  ADC_CommonInitStructure.ADC_Mode = ADC_Mode_Independent;//独立模式
  ADC_CommonInitStructure.ADC_TwoSamplingDelay = ADC_TwoSamplingDelay_10Cycles;//两个采样阶段之间的延迟5个时钟
  ADC_CommonInitStructure.ADC_DMAAccessMode = ADC_DMAAccessMode_Disabled; //DMA失能
  ADC_CommonInitStructure.ADC_Prescaler = ADC_Prescaler_Div4;//预分频4分频。ADCCLK=PCLK2/4=84/4=21Mhz,ADC时钟最好不要超过36Mhz 
  ADC_CommonInit(&ADC_CommonInitStructure);//初始化
	
  ADC_InitStructure.ADC_Resolution = ADC_Resolution_12b;//12位模式
  ADC_InitStructure.ADC_ScanConvMode = ENABLE;//非扫描模式	
  ADC_InitStructure.ADC_ContinuousConvMode = DISABLE;//关闭连续转换
  ADC_InitStructure.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConv_T2_TRGO;//禁止触发检测，使用软件触发
  ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;//右对齐	
  ADC_InitStructure.ADC_NbrOfConversion = 8;//1个转换在规则序列中 也就是只转换规则序列1 
  ADC_Init(ADC1, &ADC_InitStructure);//ADC初始化
	
 
	ADC_Cmd(ADC1, ENABLE);//开启AD转换器	

}				  
//获得ADC值
//ch: @ref ADC_channels 
//通道值 0~16取值范围为：ADC_Channel_0~ADC_Channel_16
//返回值:转换结果
u16 Get_Adc(u8 ch)   
{
	  	//设置指定ADC的规则组通道，一个序列，采样时间
	ADC_RegularChannelConfig(ADC1, ch, 1, ADC_SampleTime_112Cycles );	//ADC1,ADC通道,480个周期,提高采样时间可以提高精确度			    
  
	ADC_SoftwareStartConv(ADC1);		//使能指定的ADC1的软件转换启动功能	
	 
	while(!ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC ));//等待转换结束

	return ADC_GetConversionValue(ADC1);	//返回最近一次ADC1规则组的转换结果
}
//获取通道ch的转换值，取times次,然后平均 
//ch:通道编号
//times:获取次数
//返回值:通道ch的times次转换结果平均值
u16 Get_Adc_Average(u8 ch,u8 times)
{
	u32 temp_val=0;
	u8 t;
	for(t=0;t<times;t++)
	{
		temp_val+=Get_Adc(ch);
		delay_ms(5);
	}
	return temp_val/times;
} 




//定时器采集
//

//平滑滤波算法；

//



//extern u16 vol_to_temp[8][90];	 
float TableSearchTemperature(u8 jj,u16 adcv) 
{	
//	u16  k,j;	
//	u16  left = 0, right = 89, mid = 45;	
//	
//	if(adcv<vol_to_temp[jj][89])
//	{
//		return 120;			
//	}
//	else if(adcv > vol_to_temp[jj][0])
//	{		
//		return 30; //nomal temp		
//	}
//	else 
//	{		
//			for( j=0;j<7;j++ )
//			{				
//				mid = ( left + right ) / 2;
//				if( vol_to_temp[jj][mid] == adcv )
//				{
//					return (mid+31);		
//				}		
//				
//			  if( (adcv>vol_to_temp[jj][mid])&&(adcv<vol_to_temp[jj][mid-1]) )
//			  {				
//				  return (( float)(adcv- vol_to_temp[jj][mid])/(vol_to_temp[jj][mid-1]-vol_to_temp[jj][mid])  + mid+ 31);	
//		  	}	
//				
//				if( (adcv>vol_to_temp[jj][mid+1])&&(adcv<vol_to_temp[jj][mid]) )
//			  {				
//				  return (( float)(adcv- vol_to_temp[jj][mid+1])/(vol_to_temp[jj][mid]-vol_to_temp[jj][mid+1])  + mid+ 32);	
//		  	}	
//				
//				if( vol_to_temp[jj][mid] < adcv )
//					right = mid - 1;
//				else 	if( vol_to_temp[jj][mid] > adcv )
//					left = mid + 1;
//			}
//		
//	}
//	

}

#define Num 32 
//	u32 value_data[8] ={0};

void filter(void)
{
	u8 count,h,i,j,temp;
	u16 k;
	u32 value_d;
	u16 value_bu[32];
	u16 low,high,tmp;
	
	value_d =0;
		for(k=0;k<8;k++)
		{
	    low = 0;   
      high= 31; //????????  

       while (low < high) {  
        for (j= low; j< high; ++j) //????,?????  
            if (ConvertedValue[j][k]> ConvertedValue[j+1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j+1][k];ConvertedValue[j+1][k]=tmp;  
            }   
        --high;                 //??high?, ????  
        for ( j=high; j>low; --j) //????,?????  
            if (ConvertedValue[j][k]<ConvertedValue[j-1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j-1][k];ConvertedValue[j-1][k]=tmp;  
            }  
        ++low;                  //??low?,????  
      }  

	  	for(count=8;count<24;count++)
	  	{
			  value_d +=ConvertedValue[count][k];
	  	}
     
      BDAdc[k]= value_d>>4;
	  	value_d= 0;
	}

}


u16  filters(u8 k)
{
	u8 count,h,i,j;

	u32 value_d;
//	u16 value_bu[32];
	u16 low,high,tmp;
	    
	    value_d =0;
	    low = 0;   
      high= 95; //????????  

       while (low < high) {  
        for (j= low; j< high; ++j) //????,?????  
            if (ConvertedValue[j][k]> ConvertedValue[j+1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j+1][k];ConvertedValue[j+1][k]=tmp;  
            } 
        --high;                 //??high?, ????  
        for ( j=high; j>low; --j) //????,?????  
            if (ConvertedValue[j][k]<ConvertedValue[j-1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j-1][k];ConvertedValue[j-1][k]=tmp;  
            }  
        ++low;                  //??low?,????  
      }  

	  	for(count=16;count<80;count++)  //8-32  12  20    // 32 64     ******  
	  	{
			  value_d +=ConvertedValue[count][k];
	  	}
     
      return (value_d>>6);

	
}



//u16  filters(u8 k)
//{
//	u8 count,h,i,j;

//	u32 value_d;
//	u16 value_bu[32];
//	u16 low,high,tmp;
//	    
//	    value_d =0;
//	    low = 0;   
//      high= 63; //????????  

//       while (low < high) {  
//        for (j= low; j< high; ++j) //????,?????  
//            if (ConvertedValue[j][k]> ConvertedValue[j+1][k]) {  
//                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j+1][k];ConvertedValue[j+1][k]=tmp;  
//            }   
//        --high;                 //??high?, ????  
//        for ( j=high; j>low; --j) //????,?????  
//            if (ConvertedValue[j][k]<ConvertedValue[j-1][k]) {  
//                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j-1][k];ConvertedValue[j-1][k]=tmp;  
//            }  
//        ++low;                  //??low?,????  
//      }  
//  

//			   value_d=ConvertedValue[32][k]+ConvertedValue[31][k];
//     
//         return (value_d>>1);

//	
//}








u16 GetVoltageDACS(u16 temperature,u8 index)
{
  u16 DacV=0;
	u8 i;
  //加热区间 40-99度；//31-102
	i=temperature-29;
	if(i<0)
	{
		
		
		DacV=2500;
		
		//err; 设置温度保护；
		
		return DacV;
		
		
	}
  else if(i>78)
	{
	//	i=78;
		//err ;over temp
		//DacV=2500; 
		
		//DacV=2500; 
		
    return TableDac[index][78];		//设置温度保护
	}
	
	
	else return TableDac[index][i];		
	
	
}


float  TableSearchTemperatures(u16 adcv,u8 idex)
{
	//u16 adcv;
  u16 j;
	float xs;
//	u16  min = 1000;
//	u16  IndexSearch = 0;
	
	u16  left = 0, right = 78, mid = 39;
	
 //adcv=Get_Adc_Average(1,10);
	
	if(adcv<(TableAdc[idex][78]-20))
	{
		
		OverTempAlarm();
//		//过温报警了吧；

//		if(idex==0)
//		{
//		  Send_Str(":dialogbox=1!\r\n");	//洗脱3 超温       
//		}
//		if(idex==1)
//		{
//		  Send_Str(":dialogbox=2!\r\n");	//裂解4 超温
//		}
//		if(idex==2)
//		{
//		  Send_Str(":dialogbox=3!\r\n");	//洗脱4 超温
//		}
//		if(idex==3)
//		{
//		  Send_Str(":dialogbox=4!\r\n");	//裂解3 超温
//		}
//		if(idex==4)
//		{
//		  Send_Str(":dialogbox=10!\r\n");	//洗脱1 超温
//		}
//		if(idex==5)
//		{
//		  Send_Str(":dialogbox=11!\r\n");	//裂解2 超温
//		}
//		if(idex==6)
//		{
//		  Send_Str(":dialogbox=12!\r\n");	//洗脱2 超温
//		}
//		if(idex==7)
//		{
//		  Send_Str(":dialogbox=13!\r\n");	//裂解1 超温
//		}
		

//	delay_ms(100);	
//	__set_FAULTMASK(1);
//	NVIC_SystemReset();
		
	 return 108;  
		
	}
	else if(adcv>TableAdc[idex][0])
	{
		
		return 28; //nomal temp
		
	}
	else 
	{
		
			for( j=0;j<7;j++ ) ///////////////////////////////////????????????????????????????????????
			{
				
				
				mid = ( left + right ) / 2;
				if( TableAdc[idex][mid] == adcv )
				{
					
					return (mid+29);		
				}		
				
			  if((adcv>TableAdc[idex][mid])&&(adcv<TableAdc[idex][mid-1]) )
			  {
           xs=( float) (adcv- TableAdc[idex][mid])/(TableAdc[idex][mid-1]-TableAdc[idex][mid]);
				//printf("temper=%d",mid+40);
				  return (mid+29-xs);		
		  	}	
				
				if( TableAdc[idex][mid] < adcv )
					right = mid - 1;
				else if( TableAdc[idex][mid] > adcv )
					left = mid + 1;
			}
		
	}

}